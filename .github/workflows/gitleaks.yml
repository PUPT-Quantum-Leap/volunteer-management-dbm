name: Gitleaks Security Scan

on:
  pull_request:
    branches:
      - main
  push:
    branches:
      - main
  workflow_dispatch:  # Allow manual trigger

jobs:
  gitleaks:
    name: Scan-for-secrets
    runs-on: ubuntu-latest

    steps:
       - name: Checkout code
         uses: actions/checkout@v4
         with:
           fetch-depth: 0  # Fetch all history for all branches and tags

       - name: Run Gitleaks scan
         uses: gitleaks/gitleaks-action@v2
         env:
           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
           GITLEAKS_LICENSE: ${{ secrets.GITLEAKS_LICENSE }}  # Optional: for Gitleaks Pro features

       # Optional: Upload results as artifact for review
       - name: Upload gitleaks report
         if: failure()
         uses: actions/upload-artifact@v4
         with:
           name: gitleaks-report
           path: results.sarif
           retention-days: 30